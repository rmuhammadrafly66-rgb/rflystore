<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dashboard | RFLYStore</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { background:#f4f6f9; transition:.3s }
body.dark { background:#121212; color:#f1f1f1 }

body.dark .card,
body.dark .navbar,
body.dark footer,
body.dark .form-control {
  background:#1e1e1e !important;
  color:#fff !important;
}

.card-menu {
  border-radius:16px;
  transition:.3s;
}
.card-menu:hover {
  transform: translateY(-5px);
  box-shadow:0 10px 25px rgba(0,0,0,.2);
}
</style>
</head>

<body>

<!-- PROTEKSI LOGIN -->
<script>
if(localStorage.getItem("login")!=="true"){
  location.href="index.html";
}
</script>

<!-- NAVBAR -->
<nav class="navbar navbar-dark bg-primary shadow">
  <div class="container d-flex justify-content-between align-items-center">
    <span class="navbar-brand fw-bold d-flex align-items-center">
      <img src="logo.png" height="32" class="me-2">
      RFLYStore
    </span>

    <div class="d-flex gap-2 align-items-center">
      <button class="btn btn-outline-light btn-sm" onclick="toggleDark()">ðŸŒ™</button>
      <span class="text-white small">ðŸ‘¤ <span id="userLogin"></span></span>
      <button class="btn btn-outline-light btn-sm" onclick="logout()">Logout</button>
    </div>
  </div>
</nav>

<div class="container py-4">

  <!-- WELCOME -->
  <h4 class="fw-bold">Selamat datang, <span id="welcomeUser"></span> ðŸ‘‹</h4>
  <p class="text-muted mb-4">Kelola penjualan RFLYStore dengan mudah</p>

  <!-- STAT -->
  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="text-muted">Total Produk</h6>
          <h3 id="totalProduk">0</h3>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="text-muted">Total Transaksi</h6>
          <h3 id="totalTransaksi">0</h3>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="text-muted">Total Omzet</h6>
          <h3 id="totalOmzet">Rp 0</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- GRAFIK -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h5 class="fw-bold mb-3">ðŸ“ˆ Grafik Penjualan</h5>
      <canvas id="chartPenjualan"></canvas>
    </div>
  </div>

  <!-- INPUT TRANSAKSI -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h5 class="fw-bold mb-3">âž• Input Transaksi Cepat</h5>
      <div class="row g-3">
        <div class="col-md-5">
          <select id="jualProduk" class="form-control">
            <option value="">-- Pilih Produk --</option>
          </select>
        </div>
        <div class="col-md-4">
          <input id="jualQty" type="number" class="form-control" placeholder="Jumlah">
        </div>
        <div class="col-md-3 d-grid">
          <button class="btn btn-success" onclick="jual()">ðŸ’¾ Simpan</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MENU -->
  <div class="row g-4">
    <div class="col-md-4">
      <a href="produk.html" class="text-decoration-none">
        <div class="card card-menu shadow-sm text-center p-4">
          <h1>ðŸ“¦</h1>
          <h5 class="fw-bold">Data Produk</h5>
          <p class="text-muted small">Kelola produk</p>
        </div>
      </a>
    </div>
    <div class="col-md-4">
      <a href="penjualan.html" class="text-decoration-none">
        <div class="card card-menu shadow-sm text-center p-4">
          <h1>ðŸ’°</h1>
          <h5 class="fw-bold">Penjualan</h5>
          <p class="text-muted small">Input transaksi</p>
        </div>
      </a>
    </div>
    <div class="col-md-4">
      <a href="riwayat.html" class="text-decoration-none">
        <div class="card card-menu shadow-sm text-center p-4">
          <h1>ðŸ§¾</h1>
          <h5 class="fw-bold">Riwayat</h5>
          <p class="text-muted small">Histori transaksi</p>
        </div>
      </a>
    </div>
  </div>

</div>

<footer class="mt-5 py-4 bg-primary text-white text-center">
  <img src="logo.png" height="40" class="mb-2">
  <p class="fw-bold mb-0">RFLYStore</p>
  <small>Â© 2025 RFLYStore</small>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* USER */
const user = localStorage.getItem("username") || "User";
userLogin.innerText = user;
welcomeUser.innerText = user;

/* DATA */
const produk = JSON.parse(localStorage.getItem("produk")) || [];
const riwayat = JSON.parse(localStorage.getItem("riwayat")) || [];

/* STAT */
totalProduk.innerText = produk.length;
totalTransaksi.innerText = riwayat.length;
totalOmzet.innerText =
  "Rp " + riwayat.reduce((a,b)=>a+b.total,0).toLocaleString("id-ID");

/* LOAD PRODUK */
produk.forEach((p,i)=>{
  jualProduk.innerHTML += `
    <option value="${i}">
      ${p.nama} - Rp ${p.harga.toLocaleString("id-ID")}
    </option>`;
});

/* SIMPAN TRANSAKSI */
function jual(){
  const i = jualProduk.value;
  const qty = Number(jualQty.value);
  if(i==="" || qty<=0) return alert("Lengkapi transaksi!");

  const p = produk[i];
  riwayat.push({
    tanggal: new Date().toLocaleString("id-ID"),
    user,
    produk: p.nama,
    qty,
    total: p.harga * qty
  });

  localStorage.setItem("riwayat", JSON.stringify(riwayat));
  alert("Transaksi berhasil disimpan âœ…");
  location.reload();
}

/* CHART */
new Chart(chartPenjualan, {
  type: "bar",
  data: {
    labels: riwayat.map((_,i)=>"T"+(i+1)),
    datasets: [{
      label: "Total Penjualan",
      data: riwayat.map(r=>r.total),
      backgroundColor:"#0d6efd"
    }]
  }
});

/* DARK MODE */
function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("darkMode",
    document.body.classList.contains("dark"));
}
if(localStorage.getItem("darkMode")==="true"){
  document.body.classList.add("dark");
}

/* LOGOUT */
function logout(){
  if(confirm("Logout?")){
    localStorage.clear();
    location.href="index.html";
  }
}
</script>

</body>
</html>
